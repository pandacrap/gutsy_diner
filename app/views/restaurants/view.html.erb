<% require 'date' %>
<!DOCTYPE html>
<html>
<head>
	<title>gutsydiner</title>
	<%= stylesheet_link_tag "application", media: "all",
	                                     "data-turbolinks-track" => true %>
	<%= javascript_include_tag "application", "data-turbolinks-track" => true %>
	<%= csrf_meta_tags %>
	<script src="//maps.google.com/maps/api/js?v=3.13&amp;sensor=false&amp;libraries=geometry" type="text/javascript"></script>
	<script src='//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js' type='text/javascript'></script>
</head>
<body>
<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container-fluid">
	    <!-- Brand and toggle get grouped for better mobile display -->
	    <div class="navbar-header">
			<ul class="nav nav-pills">
			 <%= link_to "gutsydiner", root_path, class: "navbar-brand" %>
			</ul>
		</div>			
	    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
	      <ul class="nav navbar-nav">
	        <li><%= render 'shared/search' %></li>
		  </ul>
		</div>
	</div>
</nav>		
<div class="container">
	<div class="row">
	  <h1><%= @results["name"] %></h1>
	  <div class="col-md-4">
		<h2>Categories</h2>
		<div>
			<% unless @results["categories"].nil? %>
				<% @results["categories"].each do |category| %>
					<h4><span class="label label-info"><%= category["name"] %></span></h4>
				<% end %>
			<% end %>
		</div>
	  </div>
	  <div class="col-md-4">	
		<h2>Address</h2>
		<div>
			<%= @results["location"]["address"] unless @results["location"]["address"].nil? %><br>
			<%= @results["location"]["city"] unless @results["location"]["city"].nil? %><%= ", " unless @results["location"]["city"].nil? %><%= @results["location"]["state"] unless @results["location"]["state"].nil? %><br>
			<br>
			<%= static_map_for(@results["location"]["lat"], @results["location"]["lng"]) %>
		</div>
	  </div>
	  <div class="col-md-4">
		<h2>Hours</h2>
		<% unless @hours["hours"].empty? %>
			<table class="table table-striped">			
			<% weekdays = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"]%>
			<% @hours["hours"]["timeframes"].each do |entry| %>
			<tr>
				<td>

						<% if entry["days"].count > 1 %>
							<%= weekdays[entry["days"].first-1]%> - <%= weekdays[entry["days"].last-1] %>
						<% else %>
							<%= weekdays[entry["days"].first-1] %>
						<% end %>

				</td> 
				<td>
					<% entry["open"].each do |time| %>					
						<%= convert_12hr_time(time["start"]) %> to <%= convert_12hr_time(time["end"]) %>
						<% unless time == entry["open"].last %>
						 <br>
						<% end %>
					<% end %>		
				</td>
			</tr>
			<% end %>
			</table>
		<% end %>
	  </div>
	</div>
	<div class="row">
		<div class="col-md-8">
			<h2>Reviews</h2>
			<div>
				<p>
					<% if @review_items.any? %>
						<table class="table table-striped">		
						<%= render partial: 'reviews/review', collection: @review_items %>
					    </table>
					<% else %>
						<h2>Be the first one to review!</h2>
					<% end %>	
				</p>
			</div>				

		</div>
		<div class="col-md-4">
			<h2>New Review</h2>
			<%= render 'reviews/review_form' %>
		</div>
	</div>
</div>
</body>
</html>