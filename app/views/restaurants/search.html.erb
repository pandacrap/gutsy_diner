<div class="container">
	<div class="row">
	  	<div class="col-md-8">	
		<table class="table table-striped">			
			<tr>
				<td>Name</td>
				<td>Location</td>
				<td>Category</td>
				<td>Ref</td>
			</tr>
			<% @results.each do |r| %>
			<tr>
				<td><%= link_to r.name, view_path(:ref => r.id) %></td>
				<td>
					<div>
						<%= r["location"]["address"] unless r["location"]["address"].nil? %><br>
						<%= r["location"]["city"] unless r["location"]["city"].nil? %><%= ", " unless r["location"]["city"].nil? %><%= r["location"]["state"] unless r["location"]["state"].nil? %><br>
					</div>				
				</td>
				<td>
					<% unless r["categories"].nil? %>
						<% r["categories"].each do |category| %>
							<%= "and" if category == r["categories"].last and category != r["categories"].first %>
							<%= category["name"] %><%= ", " unless category == r["categories"].last %>
						<% end %>
					<% end %>
				</td>
				<td><%= r.id %></td>			
			</tr>
			<% end %>
		</table>
		</div>
	  	<div class="col-md-8">			
			<div style='width: 800px;'>
			  <div id="map" style='width: 800px; height: 400px;'></div>
			</div>		
			<script type="text/javascript">
				var mapStyle = 
					[{"featureType":"water","stylers":[{"visibility":"on"},{"color":"#b5cbe4"}]},{"featureType":"landscape","stylers":[{"color":"#efefef"}]},{"featureType":"road.highway","elementType":"geometry","stylers":[{"color":"#83a5b0"}]},{"featureType":"road.arterial","elementType":"geometry","stylers":[{"color":"#bdcdd3"}]},{"featureType":"road.local","elementType":"geometry","stylers":[{"color":"#ffffff"}]},{"featureType":"poi.park","elementType":"geometry","stylers":[{"color":"#e3eed3"}]},{"featureType":"administrative","stylers":[{"visibility":"on"},{"lightness":33}]},{"featureType":"road"},{"featureType":"poi.park","elementType":"labels","stylers":[{"visibility":"on"},{"lightness":20}]},{},{"featureType":"road","stylers":[{"lightness":20}]}];
			
				handler = Gmaps.build('Google');
				handler.buildMap({ provider: {styles: mapStyle, streetViewControl: false, panControl: false, mapTypeControl: false}, internal: {id: 'map'}}, function(){
					markers = handler.addMarkers(<%=raw @hash.to_json %>);		
										
					handler.bounds.extendWith(markers);
					handler.fitMapToBounds();
					
					if (markers.length == 1){
						handler.getMap().setZoom(16);				
					}
				});	
			</script>
		</div>
	</div>
</div>